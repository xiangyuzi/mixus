<%= render "shared/header" %>

<main class="main">
  <div class="inner">
    <div class="item-wrapper">
      <div class="idea-image-wrapper">
      <%= image_tag @idea.image, class:"idea-image" %>
      </div>
      <%= link_to "by #{@idea.user.first_name}", user_path(@idea.user.id), class:"idea-user" %>
      
      <%# アイディアの投稿者とログインしているユーザーが同じであれば以下を表示する %>
      <% if user_signed_in? && @idea.order == nil %>
        <% if current_user.id == @idea.user_id %>
          <div class="idea-manage">
            <%= link_to "編集", edit_idea_path, method: :get, class: "idea-manage-btn" %>
            <%= link_to "削除", idea_path, method: :delete, class:"idea-manage-btn" %>
          </div>
        <% else %>
          <div class="idea-manage">
          <%= link_to "MATCH UP !", idea_orders_path(@idea.id) ,class:"match-up-btn" %>
          </div>
        <% end %>
      <% end %>

      <table class="idea-table">
        <tbody>
          <tr>
            <th class="idea-table__col1">キャッチフレーズ</th>
            <td class="idea-table__col2">
              <%= @idea.catchphrase %>
            </td>
          </tr>
          <tr>
            <th class="idea-table__col1">詳細</th>
            <td class="idea-table__col2">
            <%= @idea.detail %></td>
          </tr>
          <tr>
            <th class="idea-table__col1">このカタチで見てみたい！</th>
            <td class="idea-table__col2"><%= @idea.category.name %></td>
          </tr>
        </tbody>
      </table>

      <%# マッチングしたユーザーにのみ以下の作品投稿フォームを表示する %>
        <% if @idea.order.present? && @idea.creation == nil %>
          <% if user_signed_in? && current_user.id == @idea.order.user_id %>
            <div class="prototype__comments">  
            <%= form_with model: [@idea, @creation],local: true do |f|%>
              <div class="field">
                <%= f.label :image, "作品の画像" %><br />
                <%= f.file_field :image, id:"prototype_image" %><br />
                <%= f.label :day, "作成所要期間" %><br />
                <%= f.text_field :day, placeholder: "例）7日間、30時間" %><br />
                <%= f.label :comment, "コメント" %><br />
                <%= f.text_area :comment, id:"comment_text", rows: "3" %>
              </div>
              <div class="actions">
                <%= f.submit "送信する", class: :form__btn  %>
              </div>
            <% end %>
          <% end %>
        <% end %>
        <%# マッチングユーザーからの投稿作品がある場合のみ以下の詳細を表示する %>
        <% if @idea.creation.present? %>
          <div class=creation__wrapping>
            <div class="creation__image">
              <%= image_tag @creations.image %><br/>
              <%= link_to "by #{@creations.user.first_name}", user_path(@creations.user.id), class: :prototype__user %>
            </div>
            <div class="creation__body">
              <div class="creation__detail">
                <p class=detail__days>作成にかかった期間</p>
                  <%= @idea.creation.day %>
                <p class="detail__comment">作品詳細</p>
                  <%= @idea.creation.comment %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</main>

<%= render "shared/footer" %>